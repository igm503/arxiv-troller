<div class="tag-drawer-wrapper" {% if not current_tag %}style="display: none;" {% endif %}>
  <div style="
      display: flex;
      flex-direction: column;
      height: 100%;
      position: relative;
    ">
    <div style="
        padding: 15px;
        border-bottom: 1px solid #bbbb;
        background: #f8f9fa;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      ">
      <h3 style="margin: 0; font-size: 1.1rem; color: #2c3e50">
        {% if current_tag %}{{ current_tag.name }}{% endif %}
      </h3>
      <div style="display: flex; gap: 8px; align-items: center">
        <button onclick="toggleEditMode()" class="btn btn-small" id="edit-toggle-btn">
          Edit
        </button>
        <button onclick="closeTagContext()" class="remove-btn btn-small">
          ×
        </button>
      </div>
    </div>
    <div style="padding: 10px 15px; border-bottom: 1px solid #bbbb; flex-shrink: 0;" id="drawer-search-all">
      {% if tagged_papers %}
      <button class="btn" onclick="searchAllTagPapers()" style="width: 100%">
        Search Similar Papers
      </button>
      {% endif %}
    </div>
    <div style="padding: 10px; overflow-y: auto; flex: 1;" id="drawer-papers-list">
      {% for tagged in tagged_papers %}
      <div style="
          padding: 5px;
          border-bottom: 1px solid #cccc;
          font-size: 0.9rem;
          cursor: pointer;
          position: relative;
        " onclick="searchSinglePaper({{ tagged.paper.id }})" class="drawer-paper-card">
        <div style="
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
            font-size: 0.95rem;
          ">
          <a href="{% url 'papers:detail' tagged.paper.id %}?tag={{ current_tag.id }}" onclick="event.stopPropagation()"
            style="color: inherit; text-decoration: none">
            {{ tagged.paper.title|truncatechars:60 }}
          </a>
        </div>
        <div style="
            color: #999;
            font-size: 0.85rem;
            font-family: monospace;
            margin-bottom: 8px;
          ">
          <a href="https://arxiv.org/abs/{{ tagged.paper.arxiv_id }}" target="_blank" onclick="event.stopPropagation()"
            style="color: inherit; text-decoration: none">
            {{ tagged.paper.arxiv_id }}
          </a>
          <button class="remove-btn btn-small drawer-remove-btn"
            onclick="event.stopPropagation(); removeFromTag({{ tagged.paper.id }})"
            style="display: none; position: absolute; bottom: 20px; right: 8px; padding: 2px 8px; line-height: 1;">
            −
          </button>
        </div>
      </div>
      {% empty %}
      <p style="padding: 15px; color: #999; text-align: center">
        No papers tagged yet
      </p>
      {% endfor %}
    </div>
    <div style="
        padding: 10px 15px;
        border-top: 1px solid #000000;
        background: #f8f9fa;
        flex-shrink: 0;
      ">
      <button onclick="showDeleteTagButton()" class="remove-btn btn-small" id="delete-tag-btn" style="display: none; width: 100%;">
        Delete Tag
      </button>
    </div>
  </div>
</div>
<div id="delete-tag-modal" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    justify-content: center;
    align-items: center;
  ">
  <div style="
      background: #f5f5f5;
      border: 1px solid #000000;
      padding: 2rem;
      max-width: 400px;
      width: 90%;
    ">
    <h3 style="margin-top: 0; margin-bottom: 1rem; font-size: 1.1rem;">
      Delete Tag?
    </h3>
    <p style="margin-bottom: 1.5rem; color: #333;">
      Are you sure you want to delete "<span id="delete-tag-name"></span>"? This action cannot be undone.
    </p>
    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
      <button onclick="closeDeleteModal()" class="btn btn-secondary">
        Cancel
      </button>
      <button onclick="confirmDeleteTag()" class="remove-btn" style="padding: 0.625rem 1.25rem;">
        Delete Tag
      </button>
    </div>
  </div>
</div>
